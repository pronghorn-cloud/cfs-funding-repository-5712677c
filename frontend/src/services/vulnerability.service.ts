import api from './api'
import type { HeatmapResponse, Indicator, IndicatorCategory, SVIScore } from '@/types'

export const vulnerabilityService = {
  async getScores(params?: { year?: number; region_id?: string }): Promise<SVIScore[]> {
    const { data } = await api.get<SVIScore[]>('/vulnerability/scores', { params })
    return data
  },

  async getHeatmap(year: number): Promise<HeatmapResponse> {
    const { data } = await api.get<HeatmapResponse>('/vulnerability/heatmap', {
      params: { year },
    })
    return data
  },

  async compareRegions(regionIds: string[], year: number): Promise<SVIScore[]> {
    const { data } = await api.get<SVIScore[]>('/vulnerability/compare', {
      params: { region_ids: regionIds, year },
    })
    return data
  },

  async getCategories(): Promise<IndicatorCategory[]> {
    const { data } = await api.get<IndicatorCategory[]>('/vulnerability/categories')
    return data
  },

  async getIndicators(params?: {
    category_id?: string
    active_only?: boolean
  }): Promise<Indicator[]> {
    const { data } = await api.get<Indicator[]>('/vulnerability/indicators', { params })
    return data
  },

  async recalculate(params: {
    year?: number
    normalization_method?: string
    region_ids?: string[]
  }): Promise<{ regions_calculated: number; duration_seconds: number; year: number }> {
    const { data } = await api.post('/vulnerability/recalculate', params)
    return data
  },
}
