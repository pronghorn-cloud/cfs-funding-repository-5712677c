"""SVI Pydantic schemas."""

import uuid
from datetime import datetime
from decimal import Decimal

from pydantic import BaseModel


class IndicatorCategoryResponse(BaseModel):
    id: uuid.UUID
    name: str
    display_name: str
    description: str | None = None
    weight: Decimal
    sort_order: int
    indicator_count: int = 0

    model_config = {"from_attributes": True}


class IndicatorResponse(BaseModel):
    id: uuid.UUID
    category_id: uuid.UUID
    name: str
    display_name: str
    description: str | None = None
    unit: str | None = None
    data_source: str | None = None
    weight: Decimal
    is_inverse: bool
    is_active: bool

    model_config = {"from_attributes": True}


class SVIScoreResponse(BaseModel):
    id: uuid.UUID
    region_id: uuid.UUID
    region_name: str | None = None
    year: int
    composite_score: float
    grade: str
    category_scores: dict[str, float]
    risk_index: float | None = None
    normalization_method: str

    model_config = {"from_attributes": True}


class HeatmapDataPoint(BaseModel):
    region_id: uuid.UUID
    region_name: str
    latitude: float | None = None
    longitude: float | None = None
    composite_score: float
    grade: str
    category_scores: dict[str, float]


class HeatmapResponse(BaseModel):
    year: int
    data: list[HeatmapDataPoint]
    geojson: dict | None = None
    legend: dict[str, str] = {
        "A": "Low vulnerability (0-20)",
        "B": "Below average (20-40)",
        "C": "Average (40-60)",
        "D": "Above average (60-80)",
        "E": "High vulnerability (80-100)",
    }


class RegionComparison(BaseModel):
    regions: list[SVIScoreResponse]
    indicators: list[dict]


class RecalculateRequest(BaseModel):
    year: int | None = None
    normalization_method: str = "min_max"
    region_ids: list[uuid.UUID] | None = None


class RecalculateResponse(BaseModel):
    regions_calculated: int
    duration_seconds: float
    year: int
